(function(){(()=>{const elementsInProgress={},eventsInProgress={};function dispatchEvents(...e){0===e.length&&console.error("Please provide at least one event");const t={},s=[],n=[...document.querySelectorAll("[data-haste-ajax-listeners]")];e.forEach(e=>{let a=e;"string"==typeof e&&(a={name:e});let r=!1;n.forEach(e=>{-1!==e.dataset.hasteAjaxListeners.split(" ").indexOf(a.name)&&(r=!0,t[e.dataset.hasteAjaxId]=e)}),r&&s.push(a)}),Object.keys(t).length>0&&s.length>0&&s.forEach(e=>sendRequest(t,e))}function sendRequest(els,event){eventsInProgress[event.name]&&eventsInProgress[event.name].abort(),Object.keys(els).forEach(e=>{elementsInProgress[e]=event.name,els[e].classList.add("haste-ajax-reloading")});const xhr=new XMLHttpRequest;xhr.open("GET",window.location.href),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("Pragma","no-cache"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Haste-Ajax-Reload",event.name),Object.entries(event.headers||{}).forEach(e=>{xhr.setRequestHeader(...e)}),xhr.onload=()=>{if(200===xhr.status){const newEls={},entries=JSON.parse(xhr.responseText);Object.keys(entries).forEach(id=>{els[id]&&elementsInProgress[id]===event.name&&(els[id].outerHTML=entries[id],elementsInProgress[id]=null,newEls[id]=document.querySelector(`[data-haste-ajax-id="${id}"]`),[...newEls[id].getElementsByTagName("script")].forEach(script=>eval(script.innerHTML)))}),document.dispatchEvent(new CustomEvent("HasteAjaxReloadComplete",{bubbles:!1,cancelable:!1,detail:{entries:entries,event:event.name,eventData:event,oldElements:els,newElements:newEls}}))}else console.error(`The request for event "${event.name}" has failed`),console.error(xhr);eventsInProgress[event.name]=null},xhr.send(),eventsInProgress[event.name]=xhr}window.HasteAjaxReload={dispatchEvents:dispatchEvents}})()})();
//# sourceMappingURL=ajax-reload.878c9470.js.map